function getScreenSize(){var e=new Object;return e.height=window.screen.height,e.width=window.screen.width,e.ratio=window.getDevicePixelRatio(),e.userAgent=navigator.userAgent,e.pHeight=pHeight,e.pWidth=pWidth,LOG&&console.log("Setting Screen Sizes:"+e),e}function launchIntoFullscreen(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function randomIntFromInterval(e,n){return Math.floor(Math.random()*(n-e+1)+e)}function reduceHealth(e,n){return e--,0>=e?($(".healthBar").transition({height:"0%"},200),0):(healthHeight=e/n*100,perChange=healthHeight,perChange/=2,perChange+="%",LOG&&console.log(perChange),$(".healthBar").transition({height:perChange},200),e)}function updateHealth(e,n){0>=e?$(".healthBar").transition({height:"0%"},200):(healthHeight=e/n*100,perChange=healthHeight,perChange/=2,perChange+="%",LOG&&console.log(perChange),$(".healthBar").transition({height:perChange},200))}function transitScreen(e,n){$("."+e).transition({opacity:0},200,function(){$("."+e).hide(),$("."+n).css({opacity:0}),$("."+n).show(),margin=$("."+n).children(".navScreenInner").height()/2,LOG&&console.log(margin),$("."+n).transition({opacity:1},400),2*margin<window.screen.height?($("."+n).children(".navScreenInner").css({top:"50%","margin-top":-margin}),$("."+n).children(".navScreenInner").transition({opacity:1},400)):$("."+n).children(".navScreenInner").transition({opacity:1},400)})}function demoMessage(e){$(".ppi").empty(),$(".ppi").html(e)}function drawShrine(e,n,t,i){n+=drawOffset;var a=new Object,r=new fabric.Rect({left:e+t/2,top:n+i/2,width:t+1,height:i+1,fill:shrineInnerColor,centeredRotation:!0,centeredScaling:!0,originX:"center",originY:"center",selectable:!1,hasRotatingPoint:!1,hasBorder:!1,hasControls:!1,opacity:.5});canvas.add(r),a.rect1=r;var r=new fabric.Rect({left:e+t/2,top:n+i/2,width:.65*i,height:.65*i,fill:shrineColor,centeredRotation:!0,centeredScaling:!0,originX:"center",originY:"center",selectable:!1,hasRotatingPoint:!1,hasBorder:!1,hasControls:!1});canvas.add(r),a.rect2=r;var r=new fabric.Rect({left:e+t/2,top:n+i/2,width:.45*i,height:.45*i,fill:shrineInnerColor,centeredRotation:!0,centeredScaling:!0,originX:"center",originY:"center",selectable:!1,hasRotatingPoint:!1,hasBorder:!1,hasControls:!1});canvas.add(r),a.rect3=r;var r=new fabric.Rect({left:e+t/2,top:n+i/2,width:.25*i,height:.25*i,fill:shrineInnerColor,centeredRotation:!0,centeredScaling:!0,originX:"center",originY:"center",selectable:!1,hasRotatingPoint:!1,hasBorder:!1,hasControls:!1});canvas.add(r),a.rect4=r,shrineArray.push(a)}function drawTaller(e,n,t,i,a){n+=drawOffset;var r=new Array,o=new fabric.Rect({left:e+t/2,top:n+i/2,width:.65*i,height:.65*i,fill:tallerInnerColor,centeredRotation:!0,centeredScaling:!0,originX:"center",originY:"center",selectable:!1,hasRotatingPoint:!1,hasBorder:!1,hasControls:!1});r[0]=o;var l=new fabric.Text(hitText[hitGrid[a]],{left:e+t/2,top:n+i/2.1,fontSize:20,fill:"#ffffff",stroke:"#ffffff",strokeWidth:3,fontFamily:"Roboto Mono",centeredRotation:!0,centeredScaling:!0,originX:"center",originY:"center",selectable:!1,hasRotatingPoint:!1,hasBorder:!1,hasControls:!1});return r[1]=l,r}function drawStronger(e,n,t,i,a){n+=drawOffset;var r=new Array,o=new fabric.Rect({left:e+t/2,top:n+i/2,width:.65*i,height:.65*i,fill:strongerInnerColor,centeredRotation:!0,centeredScaling:!0,originX:"center",originY:"center",selectable:!1,hasRotatingPoint:!1,hasBorder:!1,hasControls:!1});r[0]=o;var l=new fabric.Text(hitText[hitGrid[a]],{left:e+t/2,top:n+i/2.1,fontSize:20,fill:"#ffffff",stroke:"#ffffff",strokeWidth:3,fontFamily:"Roboto Mono",centeredRotation:!0,centeredScaling:!0,originX:"center",originY:"center",selectable:!1,hasRotatingPoint:!1,hasBorder:!1,hasControls:!1});return r[1]=l,r}function drawSharper(e,n,t,i,a){n+=drawOffset;var r=new Array,o=new fabric.Rect({left:e+t/2,top:n+i/2,width:.65*i,height:.65*i,fill:sharperInnerColor,centeredRotation:!0,centeredScaling:!0,originX:"center",originY:"center",selectable:!1,hasRotatingPoint:!1,hasBorder:!1,hasControls:!1});r[0]=o;var l=new fabric.Text(hitText[hitGrid[a]],{left:e+t/2,top:n+i/2.1,fontSize:20,fill:"#ffffff",stroke:"#ffffff",strokeWidth:3,fontFamily:"Roboto Mono",centeredRotation:!0,centeredScaling:!0,originX:"center",originY:"center",selectable:!1,hasRotatingPoint:!1,hasBorder:!1,hasControls:!1});return r[1]=l,r}function animateBlock(e){hitGrid[e]--,0==hitGrid[e]?(textArray[e].setText(hitText[hitGrid[e]]),blockArray[e].animate("scaleX",.02,{duration:200,onChange:canvas.renderAll.bind(canvas)}),blockArray[e].animate("scaleY",.02,{duration:200,onChange:canvas.renderAll.bind(canvas)}),setTimeout(function(){tScaleY=(tileH+1)/(.65*tileH),tScaleX=(tileW+1)/(.65*tileH),LOG&&console.log("Scale factors:"+tScaleX+","+tScaleY),blockArray[e].animate("scaleX",tScaleX,{duration:200,onChange:canvas.renderAll.bind(canvas)}),blockArray[e].animate("scaleY",tScaleY,{duration:200,onChange:canvas.renderAll.bind(canvas)}),blockArray[e].set("fill",shrineInnerColor),canvas.renderAll()},200),linearGrid[e]="X"):1==hitGrid[e]?(textArray[e].setText(hitText[hitGrid[e]]),blockArray[e].animate("scaleX",.4,{duration:200,onChange:canvas.renderAll.bind(canvas)}),blockArray[e].animate("scaleY",.4,{duration:200,onChange:canvas.renderAll.bind(canvas)})):2==hitGrid[e]&&(textArray[e].setText(hitText[hitGrid[e]]),blockArray[e].animate("scaleX",.7,{duration:200,onChange:canvas.renderAll.bind(canvas)}),blockArray[e].animate("scaleY",.7,{duration:200,onChange:canvas.renderAll.bind(canvas)}))}function logMessage(e){$(".messageLog").html(e),setTimeout(function(){$(".messageLog").html("")},2e3)}function doOnOrientationChange(){switch(window.orientation){case-90:case 90:$(".rotate").css({opacity:0}),$(".rotate").show(),$(".rotateInner").css({"margin-top":-$(".rotateInner").height()/2}),$(".rotate").css({opacity:1}),$(".rotateInner").css({opacity:1});break;default:$(".rotate").hide()}}function startScoreCount(){setTimeout(function(){scoreTemp=score,LOG&&console.log("Consoling Score"),LOG&&console.log(score);var e=2e3,n=0,t=setInterval(function(){$(".score").html(n),n++,n>score&&clearInterval(t)},e/score)},200)}function detectmob(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1}$(function(){LOG&&console.log("Link Opened"),mixpanel.track("linkOpened"),FastClick.attach(document.body);var e=io(),t=window.getDevicePixelRatio(),a=1,r=new Object,o=new Object,l=new Object,c=new Object,s=0,d=10,h=d,g=16,m=h,p=!1;r.strong=3,r.strongHit=1,r.tall=2,r.tallHit=2,r.sharp=1,r.sharpHit=3,o.strong=2,o.tall=3,o.sharp=1,o.strongHit=2,o.tallHit=1,o.sharpHit=2,l.strong=1,l.tall=2,l.sharp=3,l.strongHit=3,l.tallHit=2,l.sharpHit=1,c.strong=2,c.tall=2,c.sharp=2,c.strongHit=2,c.tallHit=2,c.sharpHit=2,clans=new Array,clans.push(o),clans.push(r),clans.push(l),clans.push(c);var f="glaxo",S=0,u=0,b=0,v=new Object;flickerStarted=0;var k=new Object,w=!0,G=!1;localStorage.pwidth&&localStorage.pheight?(LOG&&console.log("From localStorage"),LOG&&console.log(localStorage.pwidth),LOG&&console.log(localStorage.pheight),pWidth=parseFloat(localStorage.pwidth),pHeight=parseFloat(localStorage.pheight),w=!0,mixpanel.track("anOldPlayer")):(mixpanel.track("aNewPlayer"),e.emit("requestDeviceData")),e.on("deviceData",function(e){k=e,localStorage.pWidth=e.pwidth,localStorage.pHeight=e.pheight,pWidth=e.pwidth,pHeight=e.pheight,w=!0,$(".ppi").empty(),$(".ppi").append(k.pheight+"<br/>"),$(".ppi").append(k.pwidth+"<br/>")}),e.on("buildingBoard",function(){$(".messageLog").html("Validating Path!!")}),e.on("replayFromServer",function(){transitScreen("gameEnd","demoArea"),$(".healthBar").css({opacity:.8}),$(".messageLog").html(""),G=!1,hitGrid.length=0,linearGrid.length=0,drawOffset=0,blockArray.length=0,textArray.length=0,shrineArray=[],gameWon=!1}),e.on("highlight",function(e){mixpanel.track("gameComplete"),score=e.gameData.score,setTimeout(function(){if(e.won)for(mixpanel.track("gameWon"),$(".messageLog").html("Congrats: Tap to Cont.."),gameWon=!0,i=0;i<shrineArray.length;i++)shrineArray[i].rect1.set("fill",highlightColor),shrineArray[i].rect2.set("fill",shrineHiglightDarkColor),shrineArray[i].rect3.set("fill",highlightColor),shrineArray[i].rect4.set("fill",shrineHiglightDarkColor),shrineArray[i].rect3.animate("angle",12960,{duration:12e4,onChange:canvas.renderAll.bind(canvas)}),shrineArray[i].rect4.animate("angle",-12960,{duration:12e4,onChange:canvas.renderAll.bind(canvas)});else gameWon=!1,mixpanel.track("gameLost"),$(".messageLog").html("Failed: Tap to Cont..");for(LOG&&console.log(JSON.stringify(e)),i=0;i<blockArray.length;i++)"X"==linearGrid[i]&&0==e.highlight[i]?(console.log("Came Inside"),blockArray[i].set("scaleX",.7),blockArray[i].set("scaleY",.7),blockArray[i].set("opacity",.8)):"X"==linearGrid[i]&&"I"!=linearGrid[i]&&1==e.highlight[i]&&e.won&&blockArray[i].set("fill",highlightColor);G=!0,LOG&&console.log("All good!"),canvas.renderAll()},2e3)}),e.on("demoHostGameSetup",function(n){e.emit("updateGlobalStatus"),transitScreen("loadingScreen","hostScreen");var n=JSON.parse(n),t=n.gameId.split("");$(".i0").val(t[0]),$(".i1").val(t[1]),$(".i2").val(t[2]),$(".i3").val(t[3]),LOG&&console.log("Host Game Setup Setting -------------------------"),LOG&&console.log(n),mixpanel.track("gameCreated")}),e.on("demoPlayerJoined",function(n){transitScreen("loadingScreen","joinScreen");var n=JSON.parse(n);LOG&&console.log(n),e.emit("updateGlobalStatus"),$(".joinScreenTwo").hide()}),e.on("wrongGameIdEntered",function(){LOG&&console.log("Wrong Id Entered"),$(".loadingText").html("Wrong Code."),setTimeout(function(){$(".joinInput").val(""),transitScreen("loadingScreen","joinScreen"),$(".i0").focus()},1e3)}),e.on("transferMelk",function(t){terminal.log(e,"Transfer Melk Inner"),transfer=Math.round(t.transfer*(n/16)),h+=transfer,updateHealth(h,m),logMessage("Received!!!"),mixpanel.track("transferedMelk")}),e.on("requestGameData",function(e){var e=JSON.parse(e);LOG&&console.log(e)}),e.on("alignScreens",function(e){$(".alignNo").html(e),S?transitScreen("hostScreen","alignScreen"):transitScreen("joinScreen","alignScreen")}),e.on("endGame",function(){b?transitScreen("demoArea","demoHome"):S?transitScreen("hostScreen","demoHome"):transitScreen("joinScreen","demoHome"),S=0,b=0,u=0,flickerStarted=0,p=!1,$(".clans").empty(),LOG&&console.log("Game Ended")}),e.on("updateGlobalStatus",function(e){LOG&&console.log(e),LOG&&console.log(e.playersJoined),LOG&&console.log(u);var n=["tallerClan","strongerClan","sharperClan","aptClan"],t=["glaxo","smith","kline","stark"],a=["st","nd","rd","th"];for($(".clans").empty(),S&&e.playersJoined>=2&&$(".startActual").removeClass("inputHidden"),i=0;i<e.playersJoined;i++){var r=t.indexOf(e.players[i].clan);th=a[e.players[i].index-1]?a[e.players[i].index-1]:"th",$(".clans").append('<div class="btnOther '+n[r]+' shadowSmall equalMargin">'+e.players[i].index+'<span class="lower">'+th+"</span> : "+t[r]+" CLAN</div>"),$(".hostScreen").children(".navScreenInner").height()>window.screen.height?$(".hostScreen").children(".navScreenInner").css({top:"0%","margin-top":0}):(margin=$(".hostScreen").children(".navScreenInner").height()/2,$(".hostScreen").children(".navScreenInner").css({top:"50%","margin-top":-margin})),$(".joinScreen").children(".navScreenInner").height()>window.screen.height?$(".joinScreen").children(".navScreenInner").css({top:"0%","margin-top":0}):(margin=$(".joinScreen").children(".navScreenInner").height()/2,$(".joinScreen").children(".navScreenInner").css({top:"50%","margin-top":-margin}))}}),e.on("showMoto",function(){LOG&&console.log("Showing Moto");var n=["Taller","Stronger","Sharper","Go!"],t=0,i=setInterval(function(){$(".loadingText").html(n[t]),t++,4==t&&(clearInterval(i),S&&e.emit("execute"))},800)}),e.on("demoDrawBoard",function(t){{var a=["glaxo","smith","kline","stark"];window.screen.height,window.screen.width}for(LOG&&console.log(t),LOG&&console.log("Drawing with following dimensions h"),terminal.log(e,t.boardHeight),terminal.log(e,t.boardHeight.toH()),LOG&&console.log(t.boardHeight),s=a.indexOf(t.clan),total=clans[s].strong+clans[s].tall+clans[s].sharp,tallPer=clans[s].tall/total*100,strongPer=clans[s].strong/total*100,sharpPer=clans[s].sharp/total*100,LOG&&console.log(total),LOG&&console.log(strongPer),LOG&&console.log(sharpPer),LOG&&console.log(tallPer),$(".taller").css({width:tallPer+"%"}),$(".stronger").css({width:strongPer+"%"}),$(".sharper").css({width:sharpPer+"%"}),backHeight=t.backData.height.toH(),backWidth=t.backData.width.toW(),backSize=backWidth+"px "+backHeight+"px",$(".demoAreaBack").css({"background-size":backSize}),$(".gameEndBack").css({"background-size":backSize}),paddingX=0,i=0;i<t.backData.index;i++)paddingX+=t.backData.widths[i];for(paddingX=paddingX.toW(),pHeight==t.backData.height?paddingY=0:(paddingY=(t.backData.height-pHeight)/2,paddingY=paddingY.toH()),backPos="-"+paddingX+"px -"+paddingY+"px",$(".demoAreaBack").css({"background-position":backPos}),$(".gameEndBack").css({"background-position":backPos}),terminal.log(e,"Padding with width: "+t.backData.widths[t.backData.index]+": "+paddingX),LOG&&terminal.log(e,t),tileH=t.boardHeight.toH()/4,tileW=(pWidth/t.cols).toW(),drawOffset=$(document).height()/2-t.boardHeight.toH()/2,terminal.log(e,"Printing TileSizes: "+tileH+" "+tileW),LOG&&terminal.log(e,"Offset:"+drawOffset+"avail:"+$(document).height()+"actual:"+$(window).height()),n=4*t.cols,LOG&&terminal.log(e,n),LOG&&console.log(drawOffset),h=Math.round(n*d/g),m=h,playerHealth=h,terminal.log(e,"Health: "+h),canvas=new fabric.Canvas("canvas",{height:t.boardHeight.toH(),width:window.screen.width,top:drawOffset,left:0,selection:!1,renderOnAddRemove:!1,stateful:!1}),canvas.selection=!1,canvas.stateful=!1,canvas.renderOnAddRemove=!1,$("#canvas").css({top:drawOffset}),drawOffset=0,hitGrid=t.linearGrid.slice(0),linearGrid=t.linearGrid.slice(0),LOG&&console.log(hitGrid),i=0;i<hitGrid.length;i++)"T"==hitGrid[i]?hitGrid[i]=clans[s].tallHit:"S"==hitGrid[i]?hitGrid[i]=clans[s].strongHit:"Z"==hitGrid[i]&&(hitGrid[i]=clans[s].sharpHit);for(LOG&&console.log("hitGrid"),LOG&&console.log(hitGrid),LOG&&console.log("LinearGrid"),LOG&&console.log(t.linearGrid),i=0;i<4;i++)for(j=0;j<t.cols;j++)switch(index=i*t.cols+j,index=index.toString(),LOG&&console.log(index),t.linearGrid[index]){case"I":drawShrine(j*tileW,i*tileH,tileW,tileH),blockArray[index]=null,textArray[index]=null;break;case"O":blockArray[index]=null,textArray[index]=null;break;case"T":obj=drawTaller(j*tileW,i*tileH,tileW,tileH,index),blockArray[index]=obj[0],textArray[index]=obj[1],canvas.add(blockArray[index]),canvas.add(textArray[index]);break;case"S":obj=drawStronger(j*tileW,i*tileH,tileW,tileH,index),blockArray[index]=obj[0],textArray[index]=obj[1],canvas.add(blockArray[index]),canvas.add(textArray[index]);break;case"Z":obj=drawSharper(j*tileW,i*tileH,tileW,tileH,index),blockArray[index]=obj[0],textArray[index]=obj[1],canvas.add(blockArray[index]),canvas.add(textArray[index])}canvas.renderAll(),transitScreen("loadingScreen","demoArea"),LOG&&console.log(blockArray),LOG&&console.log(textArray),setTimeout(function(){$(".messageLog").html("Swipe Down When Done!!"),setTimeout(function(){$(".messageLog").html("")},3e3)},500);var r=document.getElementById("demoArea"),o=new Hammer.Manager(r),l=new Hammer.Swipe;o.add(l),o.on("swipeleft",function(){terminal.log(e,"SwipeLeft"),0==t.backData.index?logMessage("No one to your Left!!"):h>0?(transfer=3*(n/16),h-=transfer,0>h?(transfer+=h,h=0,logMessage("Melk over!!"),updateHealth(h,m)):(logMessage("Transfered!!"),updateHealth(h,m)),terminal.log(e,"Transfer:"+transfer),transferData=new Object,transferData.to=t.backData.index,transferData.from=t.backData.index+1,transferData.transfer=Math.round(transfer*(16/n)),e.emit("transferMelk",transferData)):logMessage("Out of Melk!!")}),o.on("swiperight",function(){terminal.log(e,"SwipeRight"),t.backData.index==t.backData.n-1?logMessage("No one to your Right!!"):h>0?(transfer=3*(n/16),h-=transfer,0>h?(transfer+=h,h=0,logMessage("Melk over!!"),updateHealth(h,m)):(logMessage("Transfered!!"),updateHealth(h,m)),terminal.log(e,"Transfer:"+transfer),transferData=new Object,transferData.to=t.backData.index+2,transferData.from=t.backData.index+1,transferData.transfer=Math.round(transfer*(16/n)),e.emit("transferMelk",transferData)):logMessage("Out of Melk!!")}),o.on("swipedown",function(){for(terminal.log(e,"SwipeDown"),p=!0,i=0;i<blockArray.length;i++)null!=blockArray[i]&&"X"!=linearGrid[i]&&blockArray[i].set("opacity","0.3");$(".healthBar").css({opacity:.3}),$(".messageLog").html("Waiting for Others!"),build=new Object,build.grid=linearGrid,build.index=t.backData.index,e.emit("buildSubmited",build)}),$(".demoArea").bind("click",function(e){G?(gameWon?($(".winMessage").html("Congratulations!!"),$(".winSubMessage").html("You successfully created a path that connected all the shrines!!")):($(".winMessage").html("Better Luck Next Time."),$(".winSubMessage").html("You were unable to  created a path that connected all the shrines!!")),$(".replay").hide(),transitScreen("demoArea","gameEnd"),startScoreCount(),canvas.clear().renderAll()):(LOG&&console.log(e.clientX),LOG&&console.log(e.clientY),clientX=e.clientX,clientY=e.clientY,offSetXLeft=0,offSetXRight=window.screen.width,offSetYTop=$(document).height()/2-t.boardHeight.toH()/2,offSetYBottom=offSetYTop+t.boardHeight.toH(),boardX=offSetXRight-offSetXLeft,boardY=offSetYBottom-offSetYTop,clientX>offSetXLeft&&clientX<offSetXRight&&clientY>offSetYTop&&clientY<offSetYBottom&&(relativeX=clientX,relativeY=clientY-offSetYTop,posX=Math.floor(relativeX/tileW),posY=Math.floor(relativeY/tileH),clickIndex=posX+posY*t.cols,LOG&&console.log("Clicked Inside"),LOG&&console.log("Clicked on: "+clickIndex),h>0&&null!=blockArray[clickIndex]&&!p&&"X"!=linearGrid[clickIndex]&&(LOG&&console.log("called animate"),h=reduceHealth(h,m),animateBlock(clickIndex))))})}),e.on("drawBoard",function(e){for(total=clans[s].strong+clans[s].tall+clans[s].sharp,tallPer=clans[s].tall/total*100,strongPer=clans[s].strong/total*100,sharpPer=clans[s].sharp/total*100,LOG&&console.log(total),LOG&&console.log(strongPer),LOG&&console.log(sharpPer),LOG&&console.log(tallPer),$(".taller").css({width:tallPer+"%"}),$(".stronger").css({width:strongPer+"%"}),$(".sharper").css({width:sharpPer+"%"}),a=e.size.ratio/t,$(".intro").hide(),$(".screen").css({height:e.boardHeight*a}),margin=Math.round(e.boardHeight*a/2),$(".screen").css({"margin-top":-margin}),paddingHeight=e.boardHeight*a*3,$(".topScreen").css({height:paddingHeight}),$(".bottomScreen").css({height:paddingHeight}),$(".topScreen").css({"margin-top":-(margin+paddingHeight)}),$(".bottomScreen").css({"margin-top":-margin}),n=5*e.cols,LOG&&console.log(n),h=Math.round(n*d)/g,LOG&&console.log(h),i=0;i<n;i++)switch(index=i,index=index.toString(),e.linearGrid[i]){case"I":var r='<div id= "'+index+'"class="_hShrine element"><div class="_hShrineInner depth_4"></div><div class="_hShrineInner2 depth_3"></div><div class="_hShrineCircle depth_5"></div></div>';$(".screen").append(r);break;case"O":var o='<div id= "'+index+'"class="_hBlankTile element"></div>';$(".screen").append(o);break;case"T":var l='<div id= "'+index+'"class="_hTaller tile element"><div id="'+index+'i" class="_hTallerInner  depth_4"></div></div>';$(".screen").append(l);break;case"S":var c='<div id= "'+index+'"class="_hStronger tile element"><div id="'+index+'i" class="_hStrongerInner  depth_4"></div></div>';$(".screen").append(c);break;case"Z":var p='<div id= "'+index+'"class="_hSharper tile element"><div id="'+index+'i" class="_hSharperInner  depth_4"></div></div>';$(".screen").append(p);break;default:var o='<div id= "'+index+'"class="_hBlankTile element"></div>';$(".screen").append(o)}$(".element").css({width:e.tileSize,height:e.boardHeight/5});var f='<div class="_hGrass element"><div class="pattern"></div><div class="_hGrassInner"><div class="innerPattern"></div></div></div>',S='<div class="_hGrassDark element"><div class="pattern"></div><div class="_hGrassInnerDark"><div class="innerPattern"></div></div></div>';for(hitGrid=e.linearGrid.slice(0),linearGrid=e.linearGrid.slice(0),LOG&&console.log(hitGrid),i=0;i<hitGrid.length;i++)"T"==hitGrid[i]?hitGrid[i]=clans[s].tallHit:"S"==hitGrid[i]?hitGrid[i]=clans[s].strongHit:"Z"==hitGrid[i]&&(hitGrid[i]=clans[s].sharpHit);for(LOG&&console.log("hitGrid"),LOG&&console.log(hitGrid),LOG&&console.log("LinearGrid"),LOG&&console.log(e.linearGrid),i=0;i<15;i++)if(i%2)for(j=0;j<e.cols;j++)j%2?($(".topScreen").append(f),$(".bottomScreen").append(S)):($(".topScreen").append(S),$(".bottomScreen").append(f));else for(j=0;j<e.cols;j++)j%2?($(".topScreen").append(S),$(".bottomScreen").append(f)):($(".topScreen").append(f),$(".bottomScreen").append(S));$("._hGrass").css({width:e.tileSize,height:e.boardHeight/5}),$("._hGrassDark").css({width:e.tileSize,height:e.boardHeight/5});var u=e.boardHeight/5*.5;$("._hGrassInner").css({width:u,height:u,"margin-top":-u/2,"margin-left":-u/2}),$("._hGrassInnerDark").css({width:u,height:u,"margin-top":-u/2,"margin-left":-u/2}),$("._hShrineInner").css({width:1.25*u,height:1.25*u,"margin-top":-u/1.6,"margin-left":-u/1.6}),$("._hShrineInner2").css({width:u,height:u,"margin-top":-u/2,"margin-left":-u/2}),$("._hShrineCircle").css({width:u/2,height:u/2,"margin-top":-u/4,"margin-left":-u/4}),$("._hTallerInner").css({width:u,height:u,"margin-top":-u/2,"margin-left":-u/2}),$("._hStrongerInner").css({width:u,height:u,"margin-top":-u/2,"margin-left":-u/2}),$("._hSharperInner").css({width:u,height:u,"margin-top":-u/2,"margin-left":-u/2}),$(".loadingScreen").hide(),$(".gameArea").show(),$("._hTaller").bind("touchend",function(){if(h>0&&buildSubmit){var e=$(this).attr("id");e=parseInt(e),"X"!=linearGrid[e]&&"O"!=linearGrid[e]&&"I"!=linearGrid[e]&&(h=reduceHealth(h,m),hitGrid[e]--,animateTile(e,$(this)))}}),$("._hStronger").bind("touchend",function(){if(h>0&&buildSubmit){var e=$(this).attr("id");e=parseInt(e),"X"!=linearGrid[e]&&"O"!=linearGrid[e]&&"I"!=linearGrid[e]&&(h=reduceHealth(h,m),hitGrid[e]--,animateTile(e,$(this)))}}),$("._hSharper").bind("touchend",function(){if(h>0&&buildSubmit){var e=$(this).attr("id");e=parseInt(e),"X"!=linearGrid[e]&&"O"!=linearGrid[e]&&"I"!=linearGrid[e]&&(h=reduceHealth(h,m),hitGrid[e]--,animateTile(e,$(this)))}})}),$(".start").click(function(){transitScreen("demoHome","clanSelect"),S=1}),$(".join").click(function(){transitScreen("demoHome","clanSelect"),S=0}),$(".instructions").click(function(){transitScreen("demoHome","instScreen")}),$(".story").click(function(){transitScreen("demoHome","storyScreen")});var x="glaxoScreen";$(".clan").click(function(){$(this).hasClass("glaxo")?(transitScreen("clanSelect","glaxoScreen"),x="glaxoScreen"):$(this).hasClass("kline")?(transitScreen("clanSelect","klineScreen"),x="klineScreen"):$(this).hasClass("smith")?(transitScreen("clanSelect","smithScreen"),x="smithScreen"):$(this).hasClass("stark")?(transitScreen("clanSelect","starkScreen"),x="starkScreen"):$(this).hasClass("backToHome")&&transitScreen("clanSelect","demoHome")}),$(".backToClanSelect").click(function(){transitScreen(x,"clanSelect")}),$(".backToHomeFromInst").click(function(){transitScreen("instScreen","demoHome")}),$(".backToHomeFromStory").click(function(){transitScreen("storyScreen","demoHome")}),$(".glaxoSelected").click(function(){f="glaxo";var n=new Object,t=getScreenSize();n.size=t,n.clan=f,v=n,LOG&&console.log(n),S?($(".loadingText").html("Creating Game"),transitScreen("glaxoScreen","loadingScreen"),setTimeout(function(){e.emit("createGame",n)},1e3)):(transitScreen("glaxoScreen","joinScreen"),$(".i0").focus())}),$(".startDemo").click(function(){S=!0,f="glaxo";var n=new Object,t=getScreenSize();n.size=t,n.clan=f,v=n,LOG&&console.log(n),S?($(".loadingText").html("Creating Game"),setTimeout(function(){e.emit("createGame",n)},1e3)):$(".i0").focus()}),$(".execute").click(function(){LOG&&console.log("Executing the StateMent"),e.emit("execute")}),$(".smithSelected").click(function(){f="smith";var n=new Object,t=getScreenSize();n.size=t,n.clan=f,v=n,LOG&&console.log(n),S?($(".loadingText").html("Creating Game"),transitScreen("smithScreen","loadingScreen"),e.emit("createGame",n)):(transitScreen("smithScreen","joinScreen"),$(".i0").focus())}),$(".klineSelected").click(function(){f="kline";var n=new Object,t=getScreenSize();n.size=t,n.clan=f,v=n,LOG&&console.log(n),S?($(".loadingText").html("Creating Game"),transitScreen("klineScreen","loadingScreen"),e.emit("createGame",n)):(transitScreen("klineScreen","joinScreen"),$(".i0").focus())}),$(".starkSelected").click(function(){f="stark";var n=new Object,t=getScreenSize();n.size=t,n.clan=f,v=n,LOG&&console.log(n),S?($(".loadingText").html("Creating Game"),transitScreen("starkScreen","loadingScreen"),e.emit("createGame",n)):(transitScreen("starkScreen","joinScreen"),$(".i0").focus())}),$(".exitGame").click(function(){e.emit("endGame")}),$(".readyToJoin").click(function(){var n=new Object,t=$(".joinInput0").val().toUpperCase()+$(".joinInput1").val().toUpperCase()+$(".joinInput2").val().toUpperCase()+$(".joinInput3").val().toUpperCase();LOG&&console.log(t),n.gameId=t,n.size=getScreenSize(),n.clan=f,$(".loadingText").html("Joining"),transitScreen("joinScreen","loadingScreen"),S=0,setTimeout(function(){e.emit("joinGame",n)},1e3)}),$(".joinDemo").click(function(){var n=new Object,t="DEMO";LOG&&console.log(t),n.gameId=t,n.size=getScreenSize(),n.clan="glaxo",$(".loadingText").html("Joining"),S=0,setTimeout(function(){e.emit("joinGame",n)},1e3)}),$(".exitJoinGame").click(function(){transitScreen("joinScreen","demoHome")}),$(".inputBox").keyup(function(){1==this.value.length&&$(this).next(".inputBox").focus().removeClass("inputHidden")}),$(".i3").keydown(function(){$(".readyToJoin").removeClass("inputHidden")}),$(".startActual").click(function(){$(this).hasClass("inputHidden")||e.emit("alignScreens")}),$(".tapArea").click(function(){$(".loadingText").html("Ready!"),transitScreen("alignScreen","loadingScreen"),e.emit("updateReady")}),$(".doneBuild").click(function(){$(this).hasClass("inputHidden")||$(".doneBuild").html("waiting").addClass(".inputHidden")}),$(".replay").click(function(){e.emit("replay"),e.emit("execute")}),$(".exitGameEnd").click(function(){window.location.replace("http://horlicks.herokuapp.com")});{var O=0;setInterval(function(){O%2?($(".loadingText").transition({opacity:.5}),$(".alignNo").transition({opacity:.5}),$(".messageLog").transition({opacity:.5})):($(".loadingText").transition({opacity:1}),$(".alignNo").transition({opacity:1}),$(".messageLog").transition({opacity:1})),O++},300)}detectmob()?(transitScreen("demoHome","demoHome"),mixpanel.track("mobileUser")):(transitScreen("demoHome","demoDesktop"),mixpanel.track("desktopUser"))});var canvas,hitGrid=new Array,linearGrid=new Array,pHeight,pWidth,LOG=!1,terminal=new Object,highlightColor="#1DE9B6",shrineColor="#FF7700",shrineInnerColor="#FCB634",tallerColor="#D2483D",tallerInnerColor="#F9615B",strongerColor="#8F1292",strongerInnerColor="#B8D348",sharperColor="#7C76B7",sharperInnerColor="#6114CC",grassColor="#ABB850",grassDarkColor="#91A847",backColor="white",screenColor="#546E7A",shrineHiglightDarkColor="#009688",drawOffset=0,grassOffset=0,healthCanvas,shrineCanvas,hitText=["",".","..","..."],blockArray=new Array,textArray=new Array,n,playerHealth,TERMINAL=!1,shrineArray=[],gameWon=!1,score=0;terminal.log=function(e,n){TERMINAL&&e.emit("log",n)},Number.prototype.toH=function(){var e=window.screen.height,n=pHeight;return e*this/n},Number.prototype.toW=function(){var e=window.screen.width,n=pWidth;return e*this/n},window.addEventListener("orientationchange",doOnOrientationChange),doOnOrientationChange();